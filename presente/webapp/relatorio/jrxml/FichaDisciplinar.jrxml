<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RelatorioFaltas" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isSummaryWithPageHeaderAndFooter="true" uuid="b8034542-3faa-4f1b-b317-398d3141da17">
	<property name="ireport.zoom" value="0.9090909090909107"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="ESCOLA_NOME" class="java.lang.String"/>
	<parameter name="ID_TIPO_OCORRENCIA" class="java.lang.Long"/>
	<parameter name="MATRICULA" class="java.lang.String"/>
	<parameter name="NOME_ALUNO" class="java.lang.String"/>
	<parameter name="SERIE" class="java.lang.String"/>
	<parameter name="TURMA" class="java.lang.String"/>
	<parameter name="TURNO" class="java.lang.String"/>
	<parameter name="DATA_INICIO" class="java.util.Date"/>
	<parameter name="DATA_FIM" class="java.util.Date"/>
	<queryString>
		<![CDATA[select distinct
                    o.id_ocorrencia,
                    o.tmp_data,
                    to_char(o.tmp_data,'dd/mm/yyyy') as data,
                    tp.str_descricao as tipoocorrencia,
                    o.str_descricao as descricao,
                    u.str_nome as responsavel_info,
                    re.str_nome as responsavel,
                    m.str_matricula as matricula,
                    m.int_ano_letivo as ano,
                    a.str_nome as aluno,
                    s.str_descricao as serie,
                    t.str_descricao as turma,
                    case when m.str_turno = 'MANHA' then 'Matutino'
                    when m.str_turno = 'TARDE' then 'Vespertino'
                    when m.str_turno = 'NOITE' then 'Noturno'
                    else '-'
                    end as turno,
                    re.str_telefone_fixo as telefone
                from ocorrencia o
                inner join matricula m on m.id_matricula = o.id_matricula
                inner join tipo_ocorrencia tp on tp.id_tipo_ocorrencia = o.id_tipo_ocorrencia
                inner join usuario u on u.str_login = o.str_login
                inner join aluno a on a.id_aluno = m.id_aluno
                left join serie s on s.id_serie = m.id_serie
                left join turma t on t.id_turma = m.id_turma
                left join responsavel re on re.id_responsavel = m.id_responsavel
                where to_char(o.tmp_data, 'yyyy-MM-dd')
                    between to_char($P{DATA_INICIO}::date, 'yyyy-MM-dd') and to_char($P{DATA_FIM}::date, 'yyyy-MM-dd')
                and ($P{ID_TIPO_OCORRENCIA} = 0 or ($P{ID_TIPO_OCORRENCIA} <> 0 and o.id_tipo_ocorrencia = $P{ID_TIPO_OCORRENCIA}))
                and upper(a.str_nome) like upper($P{NOME_ALUNO})
                and m.str_matricula like $P{MATRICULA}
                and ((s.str_descricao is not null
                        and upper(s.str_descricao) like upper($P{SERIE})) or (s.str_descricao is null and $P{SERIE} = '%'))
                and ((t.str_descricao is not null
                        and upper(t.str_descricao) like upper($P{TURMA})) or (t.str_descricao is null and $P{TURMA} = '%'))
                and ((m.str_turno is not null
                        and m.str_turno like $P{TURNO}) or (m.str_turno is null and $P{TURNO} = '%'))
                and m.bol_ativo = true
                and a.bol_ativo = true
                group by
                    o.id_ocorrencia,
                    m.id_matricula,
                    a.id_aluno,
                    tp.id_tipo_ocorrencia,
                    u.str_login,
                    re.id_responsavel,
                    s.id_serie,
                    t.id_turma
                order by a.str_nome asc, o.tmp_data desc;]]>
	</queryString>
	<field name="data" class="java.lang.String"/>
	<field name="tipoocorrencia" class="java.lang.String"/>
	<field name="descricao" class="java.lang.String"/>
	<field name="responsavel" class="java.lang.String"/>
	<field name="responsavel_info" class="java.lang.String"/>
	<field name="matricula" class="java.lang.String"/>
	<field name="ano" class="java.lang.Integer"/>
	<field name="aluno" class="java.lang.String"/>
	<field name="serie" class="java.lang.String"/>
	<field name="turma" class="java.lang.String"/>
	<field name="turno" class="java.lang.String"/>
	<field name="telefone" class="java.lang.String"/>
	<group name="Por Aluno" isStartNewPage="true">
		<groupExpression><![CDATA[$F{aluno}]]></groupExpression>
		<groupHeader>
			<band height="165">
				<staticText>
					<reportElement mode="Opaque" x="91" y="128" width="118" height="37" backcolor="#CCCCCC" uuid="6a2d9dd7-03ea-4353-a512-fbffca8c35aa"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Tipo da Ocorrência]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="209" y="128" width="240" height="37" backcolor="#CCCCCC" uuid="a11b5689-608b-4328-b0d0-0baee974b8d0"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Descrição]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="0" y="128" width="91" height="37" backcolor="#CCCCCC" uuid="5abfc43c-74b6-4db4-8b4c-10e3fc23a0b4"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Data]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Opaque" x="449" y="128" width="106" height="37" backcolor="#CCCCCC" uuid="fd978d0e-b75a-4889-80cb-48f568c046e5"/>
					<box>
						<topPen lineWidth="1.0"/>
						<leftPen lineWidth="1.0"/>
						<bottomPen lineWidth="1.0"/>
						<rightPen lineWidth="1.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Responsável pela Informação]]></text>
				</staticText>
				<rectangle>
					<reportElement x="0" y="57" width="555" height="71" uuid="f523a324-193e-4d00-bab8-27447c3a3fe1"/>
				</rectangle>
				<staticText>
					<reportElement x="6" y="67" width="50" height="20" uuid="6abfa61a-abf4-46d9-b9c8-6868a1c1fc35"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Aluno(a):]]></text>
				</staticText>
				<staticText>
					<reportElement x="6" y="87" width="50" height="20" uuid="6e0cd870-a16b-4d2b-9beb-c41271271060"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Matrícula:]]></text>
				</staticText>
				<staticText>
					<reportElement x="6" y="107" width="70" height="20" uuid="4589768f-15eb-45a4-b70e-3a6ee7778a25"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Responsável:]]></text>
				</staticText>
				<staticText>
					<reportElement x="136" y="87" width="33" height="20" uuid="5dbe62ce-20b3-4222-81b2-0b312c720fa8"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Série:]]></text>
				</staticText>
				<staticText>
					<reportElement x="228" y="87" width="37" height="20" uuid="560f9d50-5fe1-41e0-a5da-6c18cc633aeb"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Turma:]]></text>
				</staticText>
				<staticText>
					<reportElement x="329" y="87" width="35" height="20" uuid="c069f383-823d-4edf-b7e2-bd64274b6fb9"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Turno:]]></text>
				</staticText>
				<staticText>
					<reportElement x="448" y="87" width="55" height="20" uuid="a507884d-d3e6-4b81-a32d-9ded268644d2"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Ano Letivo:]]></text>
				</staticText>
				<staticText>
					<reportElement x="329" y="107" width="35" height="20" uuid="c1ce8204-eb7d-43ac-96ff-3ada7f2ad377"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Fone:]]></text>
				</staticText>
				<textField isBlankWhenNull="true">
					<reportElement x="56" y="67" width="498" height="20" uuid="6829b16d-bbc9-4f6a-9c02-fda2f9da6a6e"/>
					<textFieldExpression><![CDATA[$F{aluno}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="56" y="87" width="80" height="20" uuid="a1066582-96bd-4848-92c5-b1afedd4761d"/>
					<textFieldExpression><![CDATA[$F{matricula}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="76" y="107" width="253" height="20" uuid="ca03bacc-b2e7-4bbb-8b51-bcb3769a3586"/>
					<textFieldExpression><![CDATA[$F{responsavel}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="169" y="87" width="59" height="20" uuid="381dbc33-fd2e-4f10-ad02-d72e731b8e20"/>
					<textFieldExpression><![CDATA[$F{serie}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="265" y="87" width="64" height="20" uuid="b8b64eb1-6b24-4595-aecf-bb17c945c227"/>
					<textFieldExpression><![CDATA[$F{turma}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="364" y="87" width="84" height="20" uuid="6dda249c-4fa7-4929-b317-b15666e3f8ef"/>
					<textFieldExpression><![CDATA[$F{turno}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="503" y="87" width="51" height="20" uuid="136614fe-455f-4d3e-8396-5aa55a1c07a5"/>
					<textFieldExpression><![CDATA[$F{ano}]]></textFieldExpression>
				</textField>
				<textField isBlankWhenNull="true">
					<reportElement x="364" y="107" width="190" height="20" uuid="b472a060-95b5-4356-b4c2-d20622949209"/>
					<textFieldExpression><![CDATA[$F{telefone}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="1" y="0" width="555" height="28" uuid="d8802e76-621e-4b4d-aff0-ff07a87d14f7"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="20" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$P{ESCOLA_NOME}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="210" y="34" width="136" height="20" uuid="eeb08227-72fe-4bd6-bae5-fa50db047fee"/>
					<textElement textAlignment="Center">
						<font size="12" isBold="true"/>
					</textElement>
					<text><![CDATA[FICHA DISCIPLINAR]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="0" y="0" width="91" height="20" uuid="510e539b-4316-405e-a277-a429e50afb5d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{data}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="91" y="0" width="118" height="20" uuid="7d79a191-0ab9-4197-8f26-7c10e16c7a32"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{tipoocorrencia}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="209" y="0" width="240" height="20" uuid="da8bae24-999a-41ac-bde4-559126658783"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<paragraph leftIndent="5" rightIndent="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descricao}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="449" y="0" width="106" height="20" uuid="27118e9e-38a6-4b23-9fda-a0a72c5b8a2d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{responsavel_info}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="27" splitType="Stretch">
			<textField>
				<reportElement x="430" y="7" width="48" height="20" uuid="71dc12d3-b455-468a-abb6-4f264f033b99"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="501" y="7" width="54" height="20" uuid="b305f03e-68d3-471d-b7b7-e66b5f6fa8f0"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="479" y="7" width="22" height="20" uuid="15128536-e24c-4702-bcd8-19de846cd7f5"/>
				<textElement textAlignment="Center"/>
				<text><![CDATA[de]]></text>
			</staticText>
			<textField pattern="EEEEE, dd &apos;de&apos; MMMMM &apos;de&apos; yyyy">
				<reportElement x="0" y="7" width="291" height="20" uuid="2a2f8621-e75d-4671-9b85-352011c5f884"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>

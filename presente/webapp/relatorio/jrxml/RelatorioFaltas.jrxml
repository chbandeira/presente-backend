<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RelatorioFaltas" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="b8034542-3faa-4f1b-b317-398d3141da17">
	<property name="ireport.zoom" value="1.1000000000000008"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="ESCOLA_NOME" class="java.lang.String"/>
	<parameter name="ESCOLA_COD" class="java.lang.String"/>
	<parameter name="ESCOLA_UA" class="java.lang.String"/>
	<parameter name="NOME_RELATORIO" class="java.lang.String"/>
	<parameter name="DATA_INICIO" class="java.util.Date"/>
	<parameter name="DATA_FIM" class="java.util.Date"/>
	<parameter name="ANO" class="java.lang.Integer"/>
	<parameter name="MATRICULA" class="java.lang.String"/>
	<parameter name="NOME_ALUNO" class="java.lang.String"/>
	<parameter name="SERIE" class="java.lang.String"/>
	<parameter name="TURMA" class="java.lang.String"/>
	<parameter name="SALA" class="java.lang.String"/>
	<parameter name="TURNO" class="java.lang.String"/>
	<parameter name="BOLSISTA" class="java.lang.Boolean"/>
	<queryString>
		<![CDATA[select
	m.str_matricula as matricula,
	a.str_nome as nomealuno,
	s.str_descricao as serie,
	t.str_descricao as turma,
	sa.str_descricao as sala,
	case when m.str_turno = 'MANHA' then 'Matutino'
	when m.str_turno = 'TARDE' then 'Vespertino'
	when m.str_turno = 'NOITE' then 'Noturno'
	else '-'
	end as turno,
	to_char(ce.dat_data, 'dd/MM/yyyy') as data_falta,
    case when m.str_turno = 'MANHA' then 3
	when m.str_turno = 'TARDE' then 2
	when m.str_turno = 'NOITE' then 1
	else 0
	end as ordem_turno
from calendario_escolar ce, matricula m
inner join aluno a on a.id_aluno = m.id_aluno
left join serie s on s.id_serie = m.id_serie
left join turma t on t.id_turma = m.id_turma
left join sala sa on sa.id_sala = m.id_sala
where to_char(ce.dat_data, 'yyyy-MM-dd') not in (
	select to_char(r.dat_data, 'yyyy-MM-dd') from registro r
	where r.id_matricula = m.id_matricula
	and to_char(r.dat_data, 'yyyy-MM-dd') between to_char($P{DATA_INICIO}::date, 'yyyy-MM-dd') and to_char($P{DATA_FIM}::date, 'yyyy-MM-dd')
)
and ce.num_status = 1
and to_char(ce.dat_data, 'yyyy-MM-dd') between to_char($P{DATA_INICIO}::date, 'yyyy-MM-dd') and to_char($P{DATA_FIM}::date, 'yyyy-MM-dd')
and m.int_ano_letivo = $P{ANO}

and m.str_matricula like $P{MATRICULA}
and upper(a.str_nome) like upper($P{NOME_ALUNO})
and m.bol_bolsista = $P{BOLSISTA}
and ((s.str_descricao is not null
		and upper(s.str_descricao) like upper($P{SERIE})) or (s.str_descricao is null))
and ((t.str_descricao is not null
		and upper(t.str_descricao) like upper($P{TURMA})) or (t.str_descricao is null))
and ((sa.str_descricao is not null
		and upper(sa.str_descricao) like upper($P{SALA})) or (sa.str_descricao is null))
and ((m.str_turno is not null
		and m.str_turno like $P{TURNO}) or (m.str_turno is null))
and a.bol_ativo = true

group by
	m.id_matricula,
	a.id_aluno,
	s.id_serie,
	t.id_turma,
	sa.id_sala,
	ce.dat_data
order by
	ordem_turno desc,
    serie asc,
    turma asc,
    nomealuno asc;]]>
	</queryString>
	<field name="matricula" class="java.lang.String"/>
	<field name="nomealuno" class="java.lang.String"/>
	<field name="serie" class="java.lang.String"/>
	<field name="turma" class="java.lang.String"/>
	<field name="sala" class="java.lang.String"/>
	<field name="turno" class="java.lang.String"/>
	<field name="data_falta" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="90" splitType="Stretch">
			<rectangle>
				<reportElement x="0" y="1" width="555" height="89" uuid="f523a324-193e-4d00-bab8-27447c3a3fe1"/>
			</rectangle>
			<textField>
				<reportElement x="0" y="1" width="555" height="28" uuid="d8802e76-621e-4b4d-aff0-ff07a87d14f7"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="18"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{ESCOLA_NOME}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="50" width="555" height="19" uuid="7fde0200-ce22-469c-a710-c2e9d42b29dd"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["Código da Instituição: "+$P{ESCOLA_COD}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="30" width="555" height="19" uuid="06d6f553-65fc-4437-8644-b76b2e65a881"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["UA: "+$P{ESCOLA_UA}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="70" width="555" height="1" uuid="ee5bfeb7-aaed-403b-b621-12872ff70510"/>
			</line>
			<textField>
				<reportElement x="17" y="71" width="214" height="19" uuid="ab9394be-c52d-4e6e-93c1-693037422b23"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{NOME_RELATORIO}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="449" y="71" width="106" height="19" uuid="4e0984c3-90b3-492b-a04c-011f663594e8"/>
				<textElement verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{DATA_FIM}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="231" y="71" width="70" height="19" uuid="07dec451-5e50-408f-9ee0-ea71afbb8e04"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[PERÍODO:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="311" y="71" width="105" height="19" uuid="809d546a-95f6-4687-a611-447be91488b4"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{DATA_INICIO}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="416" y="70" width="33" height="20" uuid="167caefa-1a3f-49b2-aebd-3d91e3c2bdca"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[até]]></text>
			</staticText>
			<image>
				<reportElement mode="Transparent" x="17" y="6" width="70" height="57" uuid="2ef71dcb-47dd-4355-8c04-40ed0b0ace6c"/>
				<imageExpression><![CDATA["C:\\presente\\logo.jpg"]]></imageExpression>
			</image>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="28" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="91" y="8" width="176" height="20" backcolor="#CCCCCC" uuid="6a2d9dd7-03ea-4353-a512-fbffca8c35aa"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[NOME]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="267" y="8" width="50" height="20" backcolor="#CCCCCC" uuid="a11b5689-608b-4328-b0d0-0baee974b8d0"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[SÉRIE]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="317" y="8" width="50" height="20" backcolor="#CCCCCC" uuid="16c67705-30c9-4452-ad7f-ba17020936c7"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[TURMA]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="0" y="8" width="91" height="20" backcolor="#CCCCCC" uuid="5abfc43c-74b6-4db4-8b4c-10e3fc23a0b4"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[MATRICULA]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="367" y="8" width="50" height="20" backcolor="#CCCCCC" uuid="bbf68475-e43e-4a99-a362-ec99a4949690"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[SALA]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="417" y="8" width="60" height="20" backcolor="#CCCCCC" uuid="905127e1-7b01-44ed-af4f-dcc40736697e"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[TURNO]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="477" y="8" width="78" height="20" backcolor="#CCCCCC" uuid="fd978d0e-b75a-4889-80cb-48f568c046e5"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[DATA]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="91" height="20" uuid="510e539b-4316-405e-a277-a429e50afb5d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{matricula}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="91" y="0" width="176" height="20" uuid="7d79a191-0ab9-4197-8f26-7c10e16c7a32"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{nomealuno}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="267" y="0" width="50" height="20" uuid="da8bae24-999a-41ac-bde4-559126658783"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{serie}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="317" y="0" width="50" height="20" uuid="102be310-8224-4cd4-aec8-22e1ce4f84a2"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{turma}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="367" y="0" width="50" height="20" uuid="f5a19980-fa2a-4193-8362-47f9caded02a"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{sala}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="417" y="0" width="60" height="20" uuid="2d890bbf-0921-48d4-a221-42366ec0a976"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{turno}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="477" y="0" width="78" height="20" uuid="27118e9e-38a6-4b23-9fda-a0a72c5b8a2d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{data_falta}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="27" splitType="Stretch">
			<textField>
				<reportElement x="430" y="7" width="48" height="20" uuid="71dc12d3-b455-468a-abb6-4f264f033b99"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="501" y="7" width="54" height="20" uuid="b305f03e-68d3-471d-b7b7-e66b5f6fa8f0"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="479" y="7" width="22" height="20" uuid="15128536-e24c-4702-bcd8-19de846cd7f5"/>
				<textElement textAlignment="Center"/>
				<text><![CDATA[de]]></text>
			</staticText>
			<textField pattern="EEEEE, dd &apos;de&apos; MMMMM &apos;de&apos; yyyy">
				<reportElement x="0" y="7" width="291" height="20" uuid="2a2f8621-e75d-4671-9b85-352011c5f884"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>

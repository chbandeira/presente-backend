<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Presenca" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="535" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="7383014d-2a80-4165-a423-de9a299d9946">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="DATA_INICIO" class="java.util.Date"/>
	<parameter name="DATA_FIM" class="java.util.Date"/>
	<parameter name="NOME_ALUNO" class="java.lang.String"/>
	<parameter name="TURMA" class="java.lang.String"/>
	<parameter name="ANO" class="java.lang.Integer"/>
	<parameter name="ESCOLA_NOME" class="java.lang.String"/>
	<parameter name="ESCOLA_COD" class="java.lang.String"/>
	<parameter name="ESCOLA_UA" class="java.lang.String"/>
	<parameter name="NOME_RELATORIO" class="java.lang.String"/>
	<parameter name="SERIE" class="java.lang.String"/>
	<parameter name="SALA" class="java.lang.String"/>
	<parameter name="TURNO" class="java.lang.String"/>
	<parameter name="BOLSISTA" class="java.lang.Boolean"/>
	<parameter name="MATRICULA" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
     aluno."str_nome" AS nome,
     matricula."str_matricula" AS matricula,
     serie."str_descricao" AS serie,
     turma."str_descricao" AS turma,
     matricula."str_turno" AS turno,
     registro."dat_data" AS data,
     registro."str_tipo_registro" AS registro,
     matricula."int_ano_letivo" AS ano,
     configuracao_escola."str_nome" AS nome_escola
FROM "public"."configuracao_escola" configuracao_escola,
     "public"."aluno" aluno
     INNER JOIN "public"."matricula" matricula ON aluno."id_aluno" = matricula."id_aluno"
     INNER JOIN "public"."registro" registro ON matricula."id_matricula" = registro."id_matricula"
     left OUTER JOIN "public"."serie" serie ON matricula."id_serie" = serie."id_serie"
     left OUTER JOIN "public"."turma" turma ON matricula."id_turma" = turma."id_turma"
     left OUTER join sala sa on sa.id_sala = matricula.id_sala
WHERE
    to_char(registro.dat_data, 'yyyy-MM-dd') between to_char($P{DATA_INICIO}::date, 'yyyy-MM-dd') and to_char($P{DATA_FIM}::date, 'yyyy-MM-dd')
    and matricula.int_ano_letivo = $P{ANO}
    and upper(aluno.str_nome) like upper($P{NOME_ALUNO})
    and ((turma.str_descricao is not null
            and upper(turma.str_descricao) like upper($P{TURMA})) or (turma.str_descricao is null))

and matricula.str_matricula like $P{MATRICULA}
and matricula.bol_bolsista = $P{BOLSISTA}
and ((serie.str_descricao is not null
		and upper(serie.str_descricao) like upper($P{SERIE})) or (serie.str_descricao is null))
and ((sa.str_descricao is not null
		and upper(sa.str_descricao) like upper($P{SALA})) or (sa.str_descricao is null))
and ((matricula.str_turno is not null
		and matricula.str_turno like $P{TURNO}) or (matricula.str_turno is null))


ORDER BY
     serie."str_descricao" ASC,
     turma."str_descricao" ASC,
     aluno."str_nome" ASC,
     registro."dat_data" ASC]]>
	</queryString>
	<field name="nome" class="java.lang.String"/>
	<field name="matricula" class="java.lang.String"/>
	<field name="serie" class="java.lang.String"/>
	<field name="turma" class="java.lang.String"/>
	<field name="turno" class="java.lang.String"/>
	<field name="data" class="java.sql.Timestamp"/>
	<field name="registro" class="java.lang.String"/>
	<field name="ano" class="java.lang.Integer"/>
	<field name="nome_escola" class="java.lang.String"/>
	<variable name="registro_1" class="java.lang.Integer" resetType="Group" resetGroup="Por Aluno" calculation="Count">
		<variableExpression><![CDATA[$F{registro}]]></variableExpression>
	</variable>
	<group name="Por Aluno">
		<groupExpression><![CDATA[$F{nome}]]></groupExpression>
		<groupHeader>
			<band height="22">
				<rectangle>
					<reportElement x="0" y="0" width="555" height="22" backcolor="#CCCCCC" uuid="764a3ea1-fcd2-4ff1-8aef-812b6f7f632d"/>
					<graphicElement>
						<pen lineWidth="0.0"/>
					</graphicElement>
				</rectangle>
				<textField isStretchWithOverflow="true">
					<reportElement x="429" y="1" width="45" height="21" uuid="6ddc1278-7e41-41b7-b4f4-3e6fc025e7f6"/>
					<textElement verticalAlignment="Middle">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{serie} == null ? "" : $F{serie}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true">
					<reportElement x="515" y="1" width="40" height="21" uuid="67955573-4b86-4649-aa26-5d9a0be414ab"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{turma} == null ? "" : $F{turma}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="157" y="1" width="238" height="21" uuid="0f36673e-e118-4021-bf2d-39721ede4365"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression><![CDATA[$F{nome} == null ? "" : $F{nome}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true">
					<reportElement x="63" y="1" width="56" height="21" uuid="dad0d63d-bdd3-42f3-a375-b4578e8ae59d"/>
					<textElement verticalAlignment="Middle">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{matricula} == null ? "" : $F{matricula}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement mode="Transparent" x="32" y="1" width="31" height="21" forecolor="#000000" backcolor="#FFFFFF" uuid="de83b77d-eff4-4252-8335-3ef19db44ef0"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[MTC:]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Transparent" x="123" y="1" width="34" height="21" forecolor="#000000" backcolor="#FFFFFF" uuid="7d64c8df-c016-4ebd-b098-28e749383102"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[NOME:]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Transparent" x="474" y="1" width="41" height="21" forecolor="#000000" backcolor="#FFFFFF" uuid="0fd54d16-86f6-4246-89f5-fa41710d8f5b"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[TURMA:]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Transparent" x="395" y="1" width="34" height="21" forecolor="#000000" backcolor="#FFFFFF" uuid="c8e870d2-c86e-486a-83e6-0a0bd31270a1"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[SÉRIE:]]></text>
				</staticText>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<textField>
					<reportElement x="75" y="0" width="29" height="20" uuid="396a2534-c107-47a2-adc4-7fb0fc162ba3"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{registro_1} == null ? 0 : $V{registro_1}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement mode="Transparent" x="105" y="0" width="62" height="20" forecolor="#000000" backcolor="#FFFFFF" uuid="fb078bae-6e48-4dac-8d6b-530d8538eab0"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="8" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[REGISTROS]]></text>
				</staticText>
				<staticText>
					<reportElement mode="Transparent" x="30" y="0" width="45" height="20" forecolor="#000000" backcolor="#FFFFFF" uuid="b1f58c9a-f6da-46a5-8f56-1f918fb2a9b1"/>
					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="8" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<text><![CDATA[TOTAL DE ]]></text>
				</staticText>
			</band>
		</groupFooter>
	</group>
	<title>
		<band height="47">
			<frame>
				<reportElement mode="Opaque" x="0" y="-20" width="555" height="67" backcolor="#FFFFFF" uuid="dcea6ca3-1df0-408e-8c5c-2f6ebe17e7f8"/>
				<staticText>
					<reportElement x="97" y="36" width="190" height="25" forecolor="#000000" uuid="fa37c152-9d65-40c0-b9c9-5f9d5c98daa8"/>
					<textElement textAlignment="Justified" verticalAlignment="Middle">
						<font size="12" isBold="true"/>
					</textElement>
					<text><![CDATA[Relatório de Entrada e Saída]]></text>
				</staticText>
				<textField>
					<reportElement mode="Transparent" x="97" y="15" width="214" height="20" forecolor="#000000" backcolor="#FFFFFF" uuid="53974143-d7fc-4b49-9537-7ea8ff9b3823"/>
					<textElement textAlignment="Justified" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="14" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{nome_escola} == null ? "" : $F{nome_escola}]]></textFieldExpression>
				</textField>
				<image>
					<reportElement mode="Transparent" x="27" y="6" width="70" height="57" uuid="4273a106-075f-4335-a98a-17e5ecb8d935"/>
					<imageExpression><![CDATA["C:\\presente\\logo.jpg"]]></imageExpression>
				</image>
				<textField pattern="dd/MM/yyyy">
					<reportElement x="465" y="46" width="90" height="15" uuid="e6e51531-1238-4b68-a6f4-d3f553e6bab8"/>
					<textElement verticalAlignment="Middle">
						<font size="8" isBold="false"/>
					</textElement>
					<textFieldExpression><![CDATA[$P{DATA_FIM}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="445" y="46" width="20" height="15" uuid="a328dbc1-fbae-4587-89c6-a308a047970b"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8"/>
					</textElement>
					<text><![CDATA[até]]></text>
				</staticText>
				<textField pattern="dd/MM/yyyy">
					<reportElement x="376" y="46" width="69" height="15" uuid="8aaae9fe-8fda-42c8-8b37-7e0c40fa756d"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="8" isBold="false"/>
					</textElement>
					<textFieldExpression><![CDATA[$P{DATA_INICIO}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="324" y="46" width="52" height="15" uuid="51dc0cee-1f25-442a-b443-8b0643c076eb"/>
					<textElement textAlignment="Justified" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[PERÍODO:]]></text>
				</staticText>
			</frame>
		</band>
	</title>
	<pageHeader>
		<band/>
	</pageHeader>
	<detail>
		<band height="20">
			<textField isStretchWithOverflow="true" pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="98" y="0" width="155" height="20" uuid="1c1576aa-af2f-46d5-ac7d-a4721626bcd6"/>
				<textElement textAlignment="Justified" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{data}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="30" y="0" width="67" height="20" uuid="f97376a0-c4be-4919-bb5d-8ee55bed72c0"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{registro}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="17">
			<textField>
				<reportElement mode="Opaque" x="0" y="4" width="515" height="13" backcolor="#FFFFFF" uuid="ed1da1a4-1ec4-43bd-b47b-31693fcad5a6"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement mode="Opaque" x="515" y="4" width="40" height="13" backcolor="#FFFFFF" uuid="59821623-def1-46a2-86af-1f338cea9cfd"/>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement x="30" y="4" width="139" height="13" uuid="db0d0dc0-e7b2-45fc-82f6-ac727a2efe23"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>

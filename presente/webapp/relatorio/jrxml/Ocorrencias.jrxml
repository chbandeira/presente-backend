<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Ocorrencias" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isSummaryWithPageHeaderAndFooter="true" uuid="4422eee1-8642-4c1d-9163-3f6012e41715">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="ESCOLA_NOME" class="java.lang.String"/>
	<parameter name="ESCOLA_COD" class="java.lang.String"/>
	<parameter name="ESCOLA_UA" class="java.lang.String"/>
	<parameter name="NOME_RELATORIO" class="java.lang.String"/>
	<parameter name="DATA_INICIO" class="java.util.Date"/>
	<parameter name="DATA_FIM" class="java.util.Date"/>
	<parameter name="ANO" class="java.lang.Integer"/>
	<parameter name="MATRICULA" class="java.lang.String"/>
	<parameter name="NOME_ALUNO" class="java.lang.String"/>
	<parameter name="SERIE" class="java.lang.String"/>
	<parameter name="TURMA" class="java.lang.String"/>
	<parameter name="SALA" class="java.lang.String"/>
	<parameter name="TURNO" class="java.lang.String"/>
	<parameter name="BOLSISTA" class="java.lang.Boolean"/>
	<parameter name="ID_OCORRENCIA" class="java.lang.Long">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="ID_TIPO_OCORRENCIA" class="java.lang.Long">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="MATRICULAS" class="java.lang.String"/>
	<parameter name="ID_OCORRENCIAS" class="java.lang.String"/>
	<queryString language="SQL">
		<![CDATA[select
     o.tmp_data AS ocorrencia_tmp_data,
     o.str_descricao AS ocorrencia_str_descricao,
     o.num_dias AS ocorrencia_num_dias,
     u.str_nome AS ocorrencia_str_login,
     tip.str_descricao AS tipo_ocorrencia_str_descricao,
     o.id_ocorrencia AS ocorrencia_id_ocorrencia,
     o.tmp_geracao AS ocorrencia_tmp_geracao,
	m.str_matricula as matricula_str_matricula,
	a.str_nome as aluno_str_nome,
	s.str_descricao as serie_str_descricao,
	t.str_descricao as turma_str_descricao,
	sa.str_descricao as sala,
	case when m.str_turno = 'MANHA' then 'Matutino'
	when m.str_turno = 'TARDE' then 'Vespertino'
	when m.str_turno = 'NOITE' then 'Noturno'
	else '-'
	end as matricula_str_turno,
    m.bol_ativo AS matricula_bol_ativo,
	ce.str_nome AS configuracao_escola_str_nome
from configuracao_escola ce, ocorrencia o
inner join matricula m on o.id_matricula = m.id_matricula
inner join tipo_ocorrencia tip on tip.id_tipo_ocorrencia = o.id_tipo_ocorrencia
inner join aluno a on a.id_aluno = m.id_aluno
inner join usuario u on u.str_login = o.str_login
left join serie s on s.id_serie = m.id_serie
left join turma t on t.id_turma = m.id_turma
left join sala sa on sa.id_sala = m.id_sala
where to_char(o.tmp_data, 'yyyy-MM-dd')
between to_char($P{DATA_INICIO}::date, 'yyyy-MM-dd') and to_char($P{DATA_FIM}::date, 'yyyy-MM-dd')
and m.int_ano_letivo = $P{ANO}
and ($P{ID_TIPO_OCORRENCIA} = 0 or ($P{ID_TIPO_OCORRENCIA} <> 0 and o.id_tipo_ocorrencia = $P{ID_TIPO_OCORRENCIA}))
and (
    ($P{ID_OCORRENCIA} <> 0 and o.id_ocorrencia = $P{ID_OCORRENCIA})
    or ($P{ID_OCORRENCIA} = 0 and $P{ID_OCORRENCIAS} is not null and o.id_ocorrencia in ($P!{ID_OCORRENCIAS}))
    or ($P{ID_OCORRENCIA} = 0 and $P{ID_OCORRENCIAS} is null and o.id_ocorrencia > 0)
    )

and upper(a.str_nome) like upper($P{NOME_ALUNO})
and (($P{BOLSISTA} is not null and m.bol_bolsista = $P{BOLSISTA}) or ($P{BOLSISTA} is null))
and ((s.str_descricao is not null
		and upper(s.str_descricao) like upper($P{SERIE})) or (s.str_descricao is null))
and ((t.str_descricao is not null
		and upper(t.str_descricao) like upper($P{TURMA})) or (t.str_descricao is null))
and ((sa.str_descricao is not null
		and upper(sa.str_descricao) like upper($P{SALA})) or (sa.str_descricao is null))
and ((m.str_turno is not null
		and m.str_turno like $P{TURNO}) or (m.str_turno is null))
group by
	m.id_matricula,
	a.id_aluno,
	s.id_serie,
	t.id_turma,
	sa.id_sala,
	o.tmp_data,
     o.str_descricao,
     o.num_dias,
     o.str_login,
     tip.str_descricao,
     o.id_ocorrencia,
     o.tmp_geracao,
     ce.str_nome,
     u.str_nome
order by
	aluno_str_nome asc,
	matricula_str_matricula asc,
	o.tmp_data desc,
    o.id_ocorrencia asc,
	sala asc,
	serie_str_descricao asc,
	turma_str_descricao asc,
	matricula_str_turno asc]]>
	</queryString>
	<field name="configuracao_escola_str_nome" class="java.lang.String"/>
	<field name="matricula_str_matricula" class="java.lang.String"/>
	<field name="aluno_str_nome" class="java.lang.String"/>
	<field name="serie_str_descricao" class="java.lang.String"/>
	<field name="turma_str_descricao" class="java.lang.String"/>
	<field name="matricula_str_turno" class="java.lang.String"/>
	<field name="tipo_ocorrencia_str_descricao" class="java.lang.String"/>
	<field name="ocorrencia_num_dias" class="java.lang.Integer"/>
	<field name="ocorrencia_str_descricao" class="java.lang.String"/>
	<field name="ocorrencia_tmp_data" class="java.sql.Timestamp"/>
	<field name="ocorrencia_id_ocorrencia" class="java.lang.Long"/>
	<field name="ocorrencia_tmp_geracao" class="java.sql.Timestamp"/>
	<field name="ocorrencia_str_login" class="java.lang.String"/>
	<field name="matricula_bol_ativo" class="java.lang.Boolean"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="802" splitType="Stretch">
			<staticText>
				<reportElement x="16" y="72" width="218" height="20" uuid="bab4bf73-f4a0-43d3-a8ae-699274d59140"/>
				<text><![CDATA[A direção da escola comunica que o(a) aluno(a):]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="234" y="72" width="316" height="20" uuid="9e8407f4-a347-4156-be40-f1f0b441d064"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{aluno_str_nome}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="183" y="92" width="33" height="20" uuid="9a861445-6a15-4432-a2cb-55919461f529"/>
				<textFieldExpression><![CDATA[$F{serie_str_descricao}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="16" y="92" width="52" height="20" uuid="4dfe1c89-9b2c-4361-9065-a13582b94fe4"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Matrícula:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="70" y="92" width="78" height="20" uuid="d924e84a-1779-4c56-8a09-5e8811319602"/>
				<textFieldExpression><![CDATA[$F{matricula_str_matricula}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="152" y="92" width="29" height="20" uuid="7495e707-2062-4164-a01e-d4cb1137c8fe"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Série:]]></text>
			</staticText>
			<staticText>
				<reportElement x="218" y="92" width="35" height="20" uuid="55509dee-093b-4bd2-811c-a036cef25ffc"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Turma: ]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="258" y="92" width="33" height="20" uuid="7ee5c9af-031f-4e9b-b3a5-23d76a46e920"/>
				<textFieldExpression><![CDATA[$F{turma_str_descricao}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="294" y="92" width="33" height="20" uuid="20e3b672-4970-4790-9a16-b724b217f5b9"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Turno:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="331" y="92" width="55" height="20" uuid="2afb8007-e955-4719-838f-ab4ee234a6b5"/>
				<textFieldExpression><![CDATA[$F{matricula_str_turno}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="16" y="358" width="239" height="20" uuid="311ad3eb-98fc-4bdf-8439-3d5f6433de3e"/>
				<textElement textAlignment="Center"/>
				<text><![CDATA[Responsável pelas informações]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="142" y="254" width="113" height="20" uuid="de8ebe68-1e75-4744-8063-e0cdff867239"/>
				<textFieldExpression><![CDATA[$F{tipo_ocorrencia_str_descricao}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="16" y="124" width="305" height="20" uuid="d40b8c55-ee36-40e0-ac3d-1888b66d2c5d"/>
				<text><![CDATA[Transgrediu as normas escolares conforme registro abaixo, no dia:]]></text>
			</staticText>
			<staticText>
				<reportElement x="16" y="274" width="52" height="20" uuid="0555c730-db0e-4f03-9f29-d8e4a1b95da1"/>
				<textElement textAlignment="Right"/>
				<text><![CDATA[Qtd dias:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="68" y="274" width="33" height="20" uuid="276aa3ca-6dc6-471b-bc80-ec75f62cb781"/>
				<textFieldExpression><![CDATA[$F{ocorrencia_num_dias}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="16" y="144" width="534" height="90" uuid="307b8bd7-18f6-46ad-82b9-ac061b9553cd"/>
				<textFieldExpression><![CDATA[$F{ocorrencia_str_descricao}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="16" y="254" width="126" height="20" uuid="5e6e9d5c-ce7d-4be4-94f8-eaafbaf28d88"/>
				<text><![CDATA[Motivo pelo qual recebeu:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="331" y="124" width="108" height="20" uuid="31556d04-dc46-4f3f-844b-89d3981dab8a"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ocorrencia_tmp_data}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="16" y="326" width="242" height="20" uuid="3bae0161-f87c-4889-979e-90bad571f919"/>
				<textElement textAlignment="Center"/>
				<textFieldExpression><![CDATA[$F{ocorrencia_str_login}]]></textFieldExpression>
			</textField>
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement x="383" y="358" width="140" height="20" uuid="e6e06e19-3b8b-4145-a8e5-17c0e2af4d3f"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="294" y="327" width="249" height="20" uuid="b0441758-3733-4c02-8be3-559ad8675725"/>
				<textElement textAlignment="Center"/>
				<text><![CDATA[Assinatura do Responsável Legal]]></text>
			</staticText>
			<line>
				<reportElement x="292" y="326" width="251" height="1" uuid="783e762f-0599-4511-9468-481ef1b12be4"/>
			</line>
			<line>
				<reportElement x="9" y="325" width="251" height="1" uuid="56920e8e-cd35-4775-b614-ab90899190ac"/>
			</line>
			<staticText>
				<reportElement x="321" y="358" width="60" height="20" uuid="0ab3fde5-f04a-4d5a-be48-72dbd84e3969"/>
				<textElement textAlignment="Right"/>
				<text><![CDATA[Gama - DF,]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="39" width="555" height="20" uuid="4566d282-0aea-41d6-8a46-b34de3913d5e"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true" isItalic="true"/>
				</textElement>
				<text><![CDATA[REGISTRO DE OCORRÊNCIA]]></text>
			</staticText>
			<staticText>
				<reportElement x="339" y="254" width="127" height="20" uuid="fc9b463c-8300-47d6-bffd-48d15ad195ba"/>
				<textElement textAlignment="Right"/>
				<text><![CDATA[Número da Ocorrência:]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="466" y="254" width="84" height="20" uuid="960ccb36-587e-4697-a0ac-195ccfd6f008"/>
				<textFieldExpression><![CDATA[$F{ocorrencia_id_ocorrencia}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="555" height="28" uuid="277c5bad-6f0c-43c7-9c7b-a5d14d114e9f"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="18"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{ESCOLA_NOME}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>

<?xml version="1.0" encoding="UTF-8"?>
<b:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:b="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans  
						http://www.springframework.org/schema/beans/spring-beans-3.1.xsd  
						http://www.springframework.org/schema/context 
						http://www.springframework.org/schema/context/spring-context-3.1.xsd
						http://www.springframework.org/schema/tx 
						http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
						http://www.springframework.org/schema/security
						http://www.springframework.org/schema/security/spring-security-3.1.xsd">

	<!-- DataSource -->
	<b:bean id="dataSource"
		class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<b:property name="driverClassName" value="org.postgresql.Driver" />
		<b:property name="url" value="jdbc:postgresql://localhost:5432/presente" />
		<b:property name="username" value="presente" />
		<b:property name="password" value="presente4123" />
	</b:bean>

	<!-- Using Annotations for mapping -->
	<b:bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<!-- property for DataBase -->
		<b:property name="dataSource" ref="dataSource" />
		<!-- informing the annotated classes -->
		<b:property name="packagesToScan" value="br.com.w2c.model"/>
		<!-- Property of Hibernate -->
		<b:property name="hibernateProperties">
			<b:props>
				<b:prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</b:prop>
				<b:prop key="hibernate.show_sql">true</b:prop>
				<b:prop key="hibernate.hbm2ddl.auto">update</b:prop>
			</b:props>
		</b:property>
	</b:bean>

	<context:annotation-config />
	<context:component-scan base-package="br.com.w2c" />
	
	<!-- declarando a transation por default busca pelo id transactionManager -->

	<tx:annotation-driven transaction-manager="transactionManager" proxy-target-class="true" />

	<tx:advice id="transactionAdvice" transaction-manager="transactionManager">
		<tx:attributes>
			<tx:method name="*" rollback-for="java.lang.Throwable"/>
		</tx:attributes>
	</tx:advice>

	<!-- faz o translate das exception para Spring Exception -->

	<b:bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />

	<b:bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<b:property name="sessionFactory" ref="sessionFactory" />
	</b:bean>
	
	<authentication-manager>
        <authentication-provider>
        	<password-encoder hash="sha-256"/>
            <jdbc-user-service data-source-ref="dataSource" 
               users-by-username-query="SELECT str_login, str_senha, bol_ativo FROM usuario WHERE str_login=?"
               authorities-by-username-query="SELECT str_login as login, str_perfil as perfil FROM usuario_perfil WHERE str_login=?" 
            />
        </authentication-provider>
    </authentication-manager>
	
	<http auto-config="true" use-expressions="true">
        <form-login login-page="/login.jsf" authentication-failure-url="/login.jsf?erro=true"/>
        
        <intercept-url pattern="/index.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
        
		<intercept-url pattern="/layout/*" access="hasAnyRole('admin','diret','coord','comum')"/>
        
		<intercept-url pattern="/views/aluno/cadastroAluno.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		<intercept-url pattern="/views/aluno/consultaAluno.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		
		<intercept-url pattern="/views/barcode/geradorBarcode.jsf" access="hasAnyRole('admin')"/>
		
		<intercept-url pattern="/views/importacao/cadastroOcorrencia.jsf" access="hasAnyRole('admin')"/>
		<intercept-url pattern="/views/importacao/importacaoDados.jsf" access="hasAnyRole('admin')"/>
		<intercept-url pattern="/views/importacao/ocorrencia.jsf" access="hasAnyRole('admin')"/>
		
		<intercept-url pattern="/views/presenca/consultaPresenca.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		
		<intercept-url pattern="/views/registro/registroEntrada.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		<intercept-url pattern="/views/registro/registroSaida.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		
		<intercept-url pattern="/views/sala/cadastroSala.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/sala/consultaSala.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/serie/cadastroSerie.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/serie/consultaSerie.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/turma/cadastroTurma.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/turma/consultaTurma.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/usuario/cadastroUsuario.jsf" access="hasAnyRole('admin','diret')"/>
		<intercept-url pattern="/views/usuario/consultaUsuario.jsf" access="hasAnyRole('admin','diret')"/>
		<intercept-url pattern="/views/usuario/alterarSenha.jsf" access="hasAnyRole('admin','diret','coord','comum')"/>
		
		<intercept-url pattern="/views/log/baixarLog.jsf" access="hasAnyRole('admin')"/>
		
		<intercept-url pattern="/views/parametro/parametrosGerais.jsf" access="hasAnyRole('admin')"/>
		
		<intercept-url pattern="/views/configuracao/configuracao.jsf" access="hasAnyRole('admin','diret')"/>
		
		<intercept-url pattern="/relatorio/*" access="hasAnyRole('admin')"/>
		
		<intercept-url pattern="/views/calendario/cadastroCalendario.jsf" access="hasAnyRole('admin','diret')"/>
		<intercept-url pattern="/views/calendario/consultaCalendario.jsf" access="hasAnyRole('admin','diret')"/>
		
		<intercept-url pattern="/views/relatorio/boletimFrequencia.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/relatorio/relatorioFaltas.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/relatorio/relatorioFrequenciaPorTurma.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/relatorio/relatorioPresenca.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/relatorio/relatorioOcorrencias.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/relatorio/relatorioFichaDisciplinar.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/disciplina/cadastroDisciplina.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/disciplina/consultaDisciplina.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/ocorrencia/cadastroOcorrencia.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/ocorrencia/consultaOcorrencia.jsf" access="hasAnyRole('admin','diret','coord')"/>
		
		<intercept-url pattern="/views/tipoOcorrencia/cadastroTipoOcorrencia.jsf" access="hasAnyRole('admin','diret','coord')"/>
		<intercept-url pattern="/views/tipoOcorrencia/consultaTipoOcorrencia.jsf" access="hasAnyRole('admin','diret','coord')"/>
    </http>
</b:beans>
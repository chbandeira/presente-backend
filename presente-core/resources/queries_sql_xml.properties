<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>SQLs</comment>
	<entry key="Presenca.relatorioOnlineFaltas">
		select
			m.str_matricula as matricula,
			a.str_nome as nome,
			s.str_descricao as serie,
			t.str_descricao as turma,
			sa.str_descricao as sala,
			case when m.str_turno = 'MANHA' then 'Matutino'
			when m.str_turno = 'TARDE' then 'Vespertino'
			else 'Noturno'
			end as turno,
			to_char(ce.dat_data, 'dd/MM/yyyy') as data
		from calendario_escolar ce, matricula m
		inner join aluno a on a.id_aluno = m.id_aluno
		left join serie s on s.id_serie = m.id_serie
		left join turma t on t.id_turma = m.id_turma
		left join sala sa on sa.id_sala = m.id_sala
		where to_char(ce.dat_data, 'yyyy-MM-dd') not in (
			select to_char(r.dat_data, 'yyyy-MM-dd') from registro r
			where r.id_matricula = m.id_matricula
			and to_char(r.dat_data, 'yyyy-MM-dd') between :dataInicio and :dataFim
		)
		and ce.num_status = 1
		and to_char(ce.dat_data, 'yyyy-MM-dd') between :dataInicio and :dataFim
		and m.int_ano_letivo = :ano
		and m.str_matricula = :matricula
		group by
			m.id_matricula,
			m.str_matricula,
			a.id_aluno,
			a.str_nome,
			s.id_serie,
			s.str_descricao,
			t.id_turma,
			t.str_descricao,
			sa.id_sala,
			sa.str_descricao,
			ce.dat_data,
			m.str_turno
		order by
			a.str_nome asc,
			m.str_matricula asc,
			ce.dat_data desc,
			sa.str_descricao asc,
			s.str_descricao asc,
			t.str_descricao asc,
			m.str_turno asc;
	</entry>
	<entry key="Presenca.relatorioOnlineFaltasComUsuario">
		select
			m.str_matricula as matricula,
			a.str_nome as nome,
			s.str_descricao as serie,
			t.str_descricao as turma,
			sa.str_descricao as sala,
			case when m.str_turno = 'MANHA' then 'Matutino'
			when m.str_turno = 'TARDE' then 'Vespertino'
			else 'Noturno'
			end as turno,
			to_char(ce.dat_data, 'dd/MM/yyyy') as data
		from calendario_escolar ce, matricula m
		inner join aluno a on a.id_aluno = m.id_aluno
		left join serie s on s.id_serie = m.id_serie
		left join turma t on t.id_turma = m.id_turma
		left join sala sa on sa.id_sala = m.id_sala
		where to_char(ce.dat_data, 'yyyy-MM-dd') not in (
			select to_char(r.dat_data, 'yyyy-MM-dd') from registro r
			where r.id_matricula = m.id_matricula
			and to_char(r.dat_data, 'yyyy-MM-dd') between :dataInicio and :dataFim
		)
		and ce.num_status = 1
		and to_char(ce.dat_data, 'yyyy-MM-dd') between :dataInicio and :dataFim
		and m.int_ano_letivo = :ano
		and m.str_matricula = :matricula
		and m.identificador = :identificador
		group by
			m.id_matricula,
			m.str_matricula,
			a.id_aluno,
			a.str_nome,
			s.id_serie,
			s.str_descricao,
			t.id_turma,
			t.str_descricao,
			sa.id_sala,
			sa.str_descricao,
			ce.dat_data,
			m.str_turno,
			m.identificador
		order by
			a.str_nome asc,
			m.str_matricula asc,
			ce.dat_data desc,
			sa.str_descricao asc,
			s.str_descricao asc,
			t.str_descricao asc,
			m.str_turno asc;
	</entry>
</properties>